<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ­¯ãƒ–ãƒ©ã‚·ãƒã‚§ãƒƒã‚«ãƒ¼ by YourLoop</title>
  <style>
    /* ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    body { margin: 0; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f5f5f5; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 16px; width: 90%; max-width: 400px; }
    .hidden { display: none; }
    h1 { font-size: 1.5rem; text-align: center; margin-bottom: 16px; }
    /* ç™»éŒ²ç”»é¢ã®ãƒ†ã‚­ã‚¹ãƒˆä¸­å¤®å¯„ã› */
    #register-screen p { text-align: center; margin: 8px 0; }
    /* äº¤æ›ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¦‹å‡ºã—ã®ä¸Šä½™ç™½ */
    #register-screen p:nth-of-type(2) { margin-top: 16px; }
    .btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; background: #4CAF50; color: #fff; font-size: 1rem; cursor: pointer; }
    .btn:active { opacity: 0.8; }
    .btn-delete { background: #f44336; }
    /* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä¸­å¤®å¯„ã›ã€é–“éš”ã‚’èª¿æ•´ */
    .options { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; }
    .option { flex: 1 1 30%; text-align: center; padding: 8px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; }
    .option.selected { border-color: #4CAF50; background: #e8f5e9; }
    img.icon { width: 64px; height: 64px; }
    /* ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤§ãã */
    #home-screen img.icon { width: 160px; height: 160px; }
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    .progress-container { width: 80%; height: 12px; background: #eee; border-radius: 6px; margin: 8px auto; overflow: hidden; }
    .progress-bar {
      height: 100%;
      width: 0%;
      min-width: 8px; /* 0%ã§ã‚‚8pxã‚’è¡¨ç¤º */
      background: #4CAF50;
      border-radius: 6px;
    }
    .status-row { display: flex; align-items: center; justify-content: space-between; }
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”»é¢ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹éƒ¨åˆ†ã‚’ä¸­å¤®å¯„ã› */
    .status-row > div:first-child { flex: 1; text-align: center; }
    .status-row span { font-size: 1rem; }
    /* äº¤æ›äºˆå®šæ—¥ã‚’ä¸­å¤®å¯„ã› */
    #status-info p { text-align: center; margin: 12px 0; font-size: 1rem; }
    .warning { font-size: 1.2rem; cursor: pointer; }
  </style>
</head>
<body>
  <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
  <div id="home-screen" class="card">
    <h1>æ­¯ãƒ–ãƒ©ã‚·ãƒã‚§ãƒƒã‚«ãƒ¼ <br>by <br>YourLoop</h1>
    <div style="text-align:center;"><img src="toothbrush.png" alt="æ­¯ãƒ–ãƒ©ã‚·" class="icon"></div>
    <button id="start-btn" class="btn">ã¯ã˜ã‚ã‚‹</button>
  </div>

  <!-- ç™»éŒ²ç”»é¢ -->
  <div id="register-screen" class="card hidden">
    <h1>ç™»éŒ²ç”»é¢</h1>
    <p>æ®‹ã‚Šã®æ¶ˆè€—åº¦åˆã„ã‚’é¸æŠ</p>
    <div id="consumption-options" class="options">
      <div class="option" data-value="100">
        <img src="brush-100.png" alt="100%" class="icon"><br>100%
      </div>
      <div class="option" data-value="75">
        <img src="brush-75.png" alt="75%" class="icon"><br>75%
      </div>
      <div class="option" data-value="50">
        <img src="brush-50.png" alt="50%" class="icon"><br>50%
      </div>
      <div class="option" data-value="25">
        <img src="brush-25.png" alt="25%" class="icon"><br>25%
      </div>
      <div class="option" data-value="0">
        <img src="brush-0.png" alt="0%" class="icon"><br>0%
      </div>
    </div>
    <p>äº¤æ›ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é¸æŠ</p>
    <div id="period-options" class="options">
      <div class="option" data-days="14">æ—©ã‚ (2é€±é–“)</div>
      <div class="option" data-days="30">æ¨™æº– (1ãƒ¶æœˆ)</div>
      <div class="option" data-days="60">é•·ã‚ (2ãƒ¶æœˆ)</div>
    </div>
    <button id="register-btn" class="btn">ç™»éŒ²</button>
  </div>

  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”»é¢ -->
  <div id="status-screen" class="card hidden">
    <h1>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h1>
    <div id="status-info">
      <div class="status-row">
        <div>
          <img id="status-img" src="brush-100.png" alt="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" class="icon"><br>
          <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
          <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
          <span id="status-percentage">100%</span>
        </div>
        <div class="warning" id="warning-icon">ğŸ”˜</div>
      </div>
      <p>äº¤æ›äºˆå®šæ—¥: <span id="status-date"></span></p>
    </div>
    <button id="reset-btn" class="btn">äº¤æ›ã—ãŸ</button>
    <button id="delete-btn" class="btn btn-delete">ç™»éŒ²å†…å®¹ã‚’å‰Šé™¤</button>
  </div>

  <script>
    // ç”»é¢è¦ç´ å–å¾—
    const home = document.getElementById('home-screen');
    const register = document.getElementById('register-screen');
    const status = document.getElementById('status-screen');
    const startBtn = document.getElementById('start-btn');
    const registerBtn = document.getElementById('register-btn');
    const resetBtn = document.getElementById('reset-btn');
    const deleteBtn = document.getElementById('delete-btn');
    const warningIcon = document.getElementById('warning-icon');
    const progressBar = document.getElementById('progress-bar');

    let selConsumption = null;
    let selPeriod = null;

    // ç”»é¢åˆ‡æ›¿é–¢æ•°
    function showScreen(screen) {
      [home, register, status].forEach(s => s.classList.add('hidden'));
      screen.classList.remove('hidden');
    }

    // ãƒ›ãƒ¼ãƒ ã‹ã‚‰ç™»éŒ²ç”»é¢ã¸
    startBtn.addEventListener('click', () => showScreen(register));

    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠå‡¦ç†
    document.querySelectorAll('#consumption-options .option').forEach(el => {
      el.addEventListener('click', () => {
        selConsumption = parseInt(el.dataset.value, 10);
        document.querySelectorAll('#consumption-options .option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
      });
    });
    document.querySelectorAll('#period-options .option').forEach(el => {
      el.addEventListener('click', () => {
        selPeriod = parseInt(el.dataset.days, 10);
        document.querySelectorAll('#period-options .option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
      });
    });

    // ç™»éŒ²å‡¦ç†
    registerBtn.addEventListener('click', () => {
      if (selConsumption === null || selPeriod === null) {
        alert('æ¶ˆè€—åº¦åˆã„ã¨äº¤æ›ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      localStorage.setItem('consumption', selConsumption);
      localStorage.setItem('period', selPeriod);
      localStorage.setItem('timestamp', new Date().toISOString());
      updateConsumption();
      renderStatus();
      showScreen(status);
    });

    // æ¶ˆè€—åº¦åˆã„æ›´æ–°å‡¦ç†
    function updateConsumption() {
      const storedCons = parseFloat(localStorage.getItem('consumption'));
      const storedPeriod = parseFloat(localStorage.getItem('period'));
      const lastTime = new Date(localStorage.getItem('timestamp'));
      const now = new Date();
      const elapsedMs = now - lastTime;
      const elapsedDays = elapsedMs / (1000 * 60 * 60 * 24);
      const lost = (elapsedDays / storedPeriod) * 100;
      let newCons = storedCons - lost;
      if (newCons < 0) newCons = 0;
      newCons = Math.round(newCons);
      localStorage.setItem('consumption', newCons);
      localStorage.setItem('timestamp', now.toISOString());
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderStatus() {
      const cons = parseInt(localStorage.getItem('consumption'), 10);
      const per = parseInt(localStorage.getItem('period'), 10);
      const now = new Date();
      const daysToAdd = per * (cons / 100);
      const nextDate = new Date(now.getTime());
      nextDate.setDate(now.getDate() + daysToAdd);

      // ç”»åƒï¼ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
      document.getElementById('status-img').src = `brush-${cons}.png`;
      document.getElementById('status-percentage').textContent = `${cons}%`;

      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
      progressBar.style.width = `${cons}%`;
      let color;
      if (cons === 0) color = '#8B0000';       // æ¿ƒèµ¤
      else if (cons === 25) color = '#FF0000';  // èµ¤
      else if (cons === 50) color = '#FFD700';  // æ¿ƒã„é»„è‰²
      else color = '#4CAF50';                   // ç·‘
      progressBar.style.backgroundColor = color;

      // äº¤æ›äºˆå®šæ—¥æ›´æ–°
      document.getElementById('status-date').textContent = nextDate.toLocaleDateString('ja-JP');
    }

    // "äº¤æ›ã—ãŸ"ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    resetBtn.addEventListener('click', () => {
      if (!confirm('æ­¯ãƒ–ãƒ©ã‚·ã‚’äº¤æ›ã—ã¾ã—ãŸã‹ï¼Ÿ')) return;
      localStorage.setItem('consumption', 100);
      localStorage.setItem('timestamp', new Date().toISOString());
      renderStatus();
    });

    // ç™»éŒ²å‰Šé™¤
    deleteBtn.addEventListener('click', () => {
      if (!confirm('ç™»éŒ²å†…å®¹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
      localStorage.removeItem('consumption');
      localStorage.removeItem('period');
      localStorage.removeItem('timestamp');
      showScreen(home);
    });

    // æ³¨æ„ã‚¢ã‚¤ã‚³ãƒ³ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
    warningIcon.addEventListener('click', () => {
      const data = {
        consumption: localStorage.getItem('consumption'),
        period: localStorage.getItem('period'),
        timestamp: localStorage.getItem('timestamp')
      };
      navigator.clipboard.writeText(JSON.stringify(data)).then(() => {
        alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®å†…å®¹ã‚’é–‹ç™ºè€…ã«é€ä¿¡ã™ã‚‹ã¨ã€LINEç­‰ã§é€šçŸ¥ãŒå±Šãã¾ã™ã€‚');
      });
    });

    // åˆæœŸè¡¨ç¤º: ç™»éŒ²æ¸ˆã¿ãªã‚‰æ¶ˆè€—åº¦åˆã„æ›´æ–°ã®ä¸Šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”»é¢ã¸
    if (localStorage.getItem('consumption') && localStorage.getItem('period')) {
      updateConsumption();
      renderStatus();
      showScreen(status);
    }
  </script>
</body>
</html>
